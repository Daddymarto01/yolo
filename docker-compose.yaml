# Docker Compose setup for the Yolo React/NodeJS application
# Builds the client (React), backend (Node/Express), and MongoDB as microservices.

# Prerequisites:
#  - Docker and Docker Compose installed
#  - Run this file from the root folder of the cloned repository

services:

  # Frontend service (React)
  martin-yolo-client:
    image: martinodongo/martin-yolo-client:v1.0.0
    build: ./client
    container_name: martin-yolo-client
    stdin_open: true
    tty: true
    ports:
      - "3000:3000"
    depends_on:
      - martin-yolo-backend
    networks:
      - app-net

  # Backend service (Node/Express)
  martin-yolo-backend:
    image: martinodongo/martin-yolo-backend:v1.0.0
    build: ./backend
    container_name: martin-yolo-backend
    stdin_open: true
    tty: true
    restart: always
    ports:
      - "5000:5000"
    depends_on:
      - app-mongo
    environment:
      # Use the Mongo container name for networking, NOT localhost
      - MONGO_URI=mongodb://app-mongo:27017/mydb
    networks:
      - app-net

  # MongoDB database service
  app-mongo:
    image: mongo:latest
    container_name: app-mongo
    restart: always
    ports:
      - "27017:27017"
    networks:
      - app-net
    volumes:
      - app-mongo-data:/data/db

# Shared Docker network for internal service communication
networks:
  app-net:
    driver: bridge
    attachable: true
    # Removed static IP/subnet to avoid overlap errors
    # Docker will handle IP assignment automatically

# Persistent MongoDB data storage
volumes:
  app-mongo-data:
    driver: local
